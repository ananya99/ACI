training_config:
  logdir: logs/${now:%Y-%m-%d}/
  exp_name: ${filename}
  checkpoint_path: null # Will train from scratch if unset
  policy_path: null # Will train from scratch if unset

  total_timesteps: 1_000_000
  max_episode_steps: 256
  n_steps: 2048

  learning_rate: 0.001
  n_epochs: 8
  gae_lambda: 0.95
  batch_size: ${eval:'${.n_steps} * ${.n_envs}'}
  n_envs: 10

  eval_freq: 10000
  no_improvement_reward_threshold: 1e3
  max_no_improvement_evals: 10 # check_freq * max_no_improvement_evals steps
  min_no_improvement_evals: 10 # check_freq * min_no_improvement_evals steps

  features_extractor_activation: ReLU

  seed: 0
  verbose: 2

env_config:
  xml: ${include:models/scene.xml,str}

  use_headlight: False
  use_ambient_light: False
  ambient_light_intensity: [0.1, 0.1, 0.1]

  reward_fn_type: intensity_and_at_goal
  reward_options:
    gamma: 4.0

  use_goal_obs: False
  terminate_at_goal: False
  truncate_on_contact: False
  distance_to_target_threshold: 2.0
  action_penalty: 0
  contact_penalty: -1.0
  force_exclusive_contact_penalty: False
  adversary_penalty: -1.0
  reward_at_goal: 1.0

  frame_skip: 10

  use_renderer: True
  add_overlays: True
  add_position_tracking_overlay: True
  overlay_width: 0.5
  overlay_height: 0.35

  renderer_config:
    extend: ${extend:${include:configs/overlays/render_bev.yaml}}

    maxgeom: 10000

    render_modes: [rgb_array]

    scene_options:
      flags: 
        mjVIS_CAMERA: True

    use_shared_context: True

  maze_selection_criteria:
    mode: NAMED
    name: G_MAZE_DIVERSE
  maze_configs:
    - G_MAZE_DIVERSE
  maze_configs_store:
    G_MAZE_DIVERSE:
      extend: ${extend:${include:configs/mazes/train/G_MAZE_DIVERSE.yaml}}
    M_MAZE_DIVERSE:
      extend: ${extend:${include:configs/mazes/train/M_MAZE_DIVERSE.yaml}}
  compute_optimal_path: False

  num_animals: ${eval:'len(${oc.dict.keys:.animal_configs})'}

evo_config:
  max_n_envs: 10

  num_generations: 200

  population_config:
    size: 4
    num_top_performers: 2

  spawning_config:
    init_num_mutations: 1
    num_mutations: 1
    mutations: [ADD_EYE, REMOVE_EYE, EDIT_EYE]

    load_policy: False

    replication_type: MUTATION

    default_animal_config:
      name: ${parent:} # will be replaced with parent key. evaluated after extend.
      use_intensity_obs: False
      use_action_obs: True
      use_init_pos_obs: False
      use_current_pos_obs: False
      n_temporal_obs: 10

      constant_actions: [0.25, null]

      disable_intensity_sensor: False
      intensity_sensor_config:
        mode: fixed
        resolution: [1, 1]
        fov: [120, 10]
        psf_filter_size: [0, 0]

        enable_optics: False
        enable_aperture: False
        enable_lens: False
        enable_phase_mask: False
        scene_angular_resolution: 1.0 # degrees
        pixel_size: 1e-3  
        scene_resolution: [80, 1]
        sensor_resolution: [60, 1]
        add_noise: False
        noise_std: 0.01

        aperture_open: 1.0
        aperture_radius: 1
        wavelengths: [610e-9, 530e-9, 470e-9]
        depth_bins: 11

        load_height_mask_from_file: False
        randomize_psf_init: False
        refractive_index: 1.5
        min_phi_defocus: -10
        max_phi_defocus: 10

        renderer_config:
          render_modes: [rgb_array]

          use_shared_context: True

      num_eyes: ${eval:'len(${oc.dict.keys:.eye_configs})'}

    default_eye_config:
      name: ${parent:} # will be replaced with parent key. evaluated after extend.
      mode: fixed
      psf_filter_size: [0, 0]

      resolution: [-1, -1] # Placeholder
      fov: [-1, -1] # Placeholder

      enable_optics: False
      enable_aperture: True
      enable_lens: False
      enable_phase_mask: False

      scene_angular_resolution: 2.0 # degrees
      pixel_size: 1e-3  
      scene_resolution: [80, 80]
      sensor_resolution: [60, 60]
      add_noise: False
      noise_std: 0.01
      aperture_open: 1.0
      aperture_radius: 1
      wavelengths: [610e-9, 530e-9, 470e-9]
      depth_bins: 11

      load_height_mask_from_file: False
      randomize_psf_init: False
      refractive_index: 1.5
      min_phi_defocus: -10
      max_phi_defocus: 10

      renderer_config:
        render_modes: [rgb_array]

        use_shared_context: True

  environment_variables: {}

logging_config:
  extend: ${extend:${include:configs/logging/default_logger.yaml}}