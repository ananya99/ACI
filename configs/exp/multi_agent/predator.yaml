# @package _global_

defaults:
  # Use one maze for the time being
  - /env/mazes/SQUARE@env.mazes.SQUARE

  # Use the maze_exp config as the base
  - /exp/maze_exp

  # Define two animals
  # The first will be the "predator" and is trainable
  - /env/animals@env.animals.animal_0: ${env/animals}
  - /env/animals/eyes@env.animals.animal_0.eyes.animal_0_eye_0: ${env/animals/eyes}
  - /env/animals/eyes@env.animals.animal_0.eyes.animal_0_eye_1: ${env/animals/eyes}
  # The second is the "prey" and has a fixed policy that tries to avoid the predator
  - /env/animals@env.animals.animal_1: ${env/animals}
  - override /env/animals: point

trainer:
  total_timesteps: 5_000_000

env:
  objects: ${clear:}

  # Set the reward fns
  reward_fn:
    euclidean_delta_from_init:
      factor: 0.0
    penalize_if_has_contacts:
      # Small penalty for hitting wall
      penalty: -0.00
    reward_if_animals_in_view:
      _target_: cambrian.envs.reward_fns.reward_if_animals_in_view
      _partial_: true

      # Reward for being close to the prey
      from_animals: [animal_0]
      to_animals: [animal_1]
      reward: 0.75

  animals:
    animal_0:
      # Predators are red
      xml:
        overrides:
          - mujoco:
              - asset:
                  - material:
                      - name: point_${parent:xml}_mat
                      - rgba: "0.8 0.1 0.1 1"
                      - emission: 2

      eyes:
        animal_0_eye_0:
          resolution: [10, 10]
          coord: [10, -25]
        animal_0_eye_1:
          resolution: [10, 10]
          coord: [10, 25]

    # Update the animal_1 to be non-trainable and set it's instance to be the correct
    # class which implements the prey-like logic
    animal_1:
      trainable: false

      instance:
        _target_: cambrian.animals.point.MjCambrianPointAnimalPrey
        _partial_: true
        predators: [animal_0]

      # Preys are green
      xml:
        overrides:
          - mujoco:
              - asset:
                  - material:
                      - name: point_${parent:xml}_mat
                      - rgba: "0.1 0.8 0.1 1"
                      - emission: 2
