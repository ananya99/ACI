defaults:
  # Set to use submitit_slurm
  - /hydra/launcher/submitit_slurm@_here_

# Set the timeout of each individual job to 1 day. Note that this isn't the total job
# length. It is recommended to start the "daemon" job using srun/sbatch on a low
# compute node. This way, you can limit the total job length to some maximum value.
timeout_min: ${eval:'60*24'} # 1 day (in min)

# Supercloud only allows allocation of 4 gpus, meaning we can only really use
# 4 nodes at any one time. To optimize usage of resources, we want to use all 4 nodes
# and also have multiple parallel workers on each node. Therefore, we have 4 nodes and
# define 4 tasks on each node. Each task gets 10 cpus each (since there's only 40 cpus)
# on each node. We specify the 4 nodes component as an array job with the
# array_parallelism parameter.
nodes: 1
tasks_per_node: 4
cpus_per_task: 10
gres: gpu:volta:1
array_parallelism: ${.tasks_per_node}

# This will increase the likelyhood of a job being selected during peak hours.
qos: high

# these are run prior to calling sbatch before running the job
setup:
  - source /etc/profile
  - export TF_CPP_MIN_LOG_LEVEL=2
  - export OPENBLAS_NUM_THREADS=1
  - export PMIX_MCA_gds=hash
